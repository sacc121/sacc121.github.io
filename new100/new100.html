<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§ä¼šãƒã‚¤ãƒ³ãƒˆé›†è¨ˆãƒ„ãƒ¼ãƒ«</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 p-4 md:p-8">
    <div class="max-w-6xl mx-auto space-y-8">
        <!-- Header -->
        <header class="flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div>
                <h1 class="text-3xl font-bold flex items-center gap-2 text-slate-900">
                    ğŸ† å¤§ä¼šãƒã‚¤ãƒ³ãƒˆé›†è¨ˆãƒ„ãƒ¼ãƒ«
                </h1>
                <p class="text-slate-500 mt-1">ã‚¹ã‚³ã‚¢ã‚’å…¥åŠ›ã™ã‚‹ã¨è‡ªå‹•ã§ãƒã‚¤ãƒ³ãƒˆã‚’æ›ç®—ã—é †ä½ã‚’æ±ºå®šã—ã¾ã™ã€‚</p>
            </div>
            <div class="flex gap-2">
                <button onclick="exportCSV()" class="flex items-center gap-2 bg-white border border-slate-200 px-4 py-2 rounded-lg hover:bg-slate-50 transition-colors shadow-sm text-sm font-medium">
                    ğŸ“¥ CSVä¿å­˜
                </button>
            </div>
        </header>

        <!-- Controls -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 space-y-4">
                <h2 class="font-semibold flex items-center gap-2 border-b pb-2 text-slate-700">
                    âš™ï¸ å¤§ä¼šè¨­å®š
                </h2>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-slate-600">è©¦åˆæ•°: <span id="match-count-display">5</span></span>
                    <div class="flex gap-1">
                        <button onclick="changeMatchCount(-1)" class="w-8 h-8 flex items-center justify-center hover:bg-slate-100 rounded border">-</button>
                        <button onclick="changeMatchCount(1)" class="w-8 h-8 flex items-center justify-center hover:bg-slate-100 rounded border">+</button>
                    </div>
                </div>
                <button onclick="addPlayer()" class="w-full flex items-center justify-center gap-2 bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition-colors text-sm font-medium">
                    ï¼‹ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½åŠ 
                </button>
            </div>

            <div class="md:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-slate-200 space-y-4">
                <h2 class="font-semibold flex items-center gap-2 border-b pb-2 text-slate-700">
                    â„¹ï¸ ãƒã‚¤ãƒ³ãƒˆæ›ç®—ãƒ«ãƒ¼ãƒ«
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-2">
                    <div class="bg-slate-50 p-2 rounded text-center border border-slate-100">
                        <div class="text-xs text-slate-500">10 / â—¯</div>
                        <div class="font-bold text-indigo-600">6 pt</div>
                    </div>
                    <div class="bg-slate-50 p-2 rounded text-center border border-slate-100">
                        <div class="text-xs text-slate-500">7-9 / â–³</div>
                        <div class="font-bold text-indigo-600">3 pt</div>
                    </div>
                    <div class="bg-slate-50 p-2 rounded text-center border border-slate-100">
                        <div class="text-xs text-slate-500">5-6</div>
                        <div class="font-bold text-indigo-600">2 pt</div>
                    </div>
                    <div class="bg-slate-50 p-2 rounded text-center border border-slate-100">
                        <div class="text-xs text-slate-500">3-4</div>
                        <div class="font-bold text-indigo-600">1 pt</div>
                    </div>
                    <div class="bg-slate-50 p-2 rounded text-center border border-slate-100">
                        <div class="text-xs text-slate-500">0-2</div>
                        <div class="font-bold text-indigo-600">0 pt</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Table -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-4 border-b bg-slate-50">
                <h2 class="font-semibold flex items-center gap-2 text-slate-700">
                    ğŸ‘¥ ã‚¹ã‚³ã‚¢å…¥åŠ›
                </h2>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse" id="input-table">
                    <thead>
                        <tr class="bg-slate-50 border-b" id="table-header">
                            <!-- JSã§ç”Ÿæˆ -->
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- JSã§ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Rankings Section -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-4 border-b bg-indigo-600">
                <h2 class="font-semibold flex items-center gap-2 text-white">
                    ğŸ† æœ€çµ‚çµæœ / ãƒ©ãƒ³ã‚­ãƒ³ã‚°
                </h2>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-slate-50 border-b">
                            <th class="p-4 font-semibold text-slate-600 text-sm text-center w-20">é †ä½</th>
                            <th class="p-4 font-semibold text-slate-600 text-sm">åå‰</th>
                            <th class="p-4 font-semibold text-slate-600 text-sm text-center">å†…è¨³(pt)</th>
                            <th class="p-4 font-semibold text-slate-600 text-sm text-center w-32">åˆè¨ˆãƒã‚¤ãƒ³ãƒˆ</th>
                        </tr>
                    </thead>
                    <tbody id="ranking-body">
                        <!-- JSã§ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let matchCount = 5;
        let players = [
            { id: 1, name: 'poyo', scores: ['', '', '', '', ''] },
            { id: 2, name: 'ã«ã£ã—ãƒ¼', scores: ['', '', '', '', ''] },
            { id: 3, name: 'takoyaki', scores: ['', '', '', '', ''] },
            { id: 4, name: 'ã‚†ã†ã¾', scores: ['', '', '', '', ''] },
            { id: 5, name: 'nono20486', scores: ['', '', '', '', ''] },
        ];

        function calculatePoints(val) {
            if (!val) return 0;
            const v = val.toString().trim();
            if (v === '10' || v === 'â—¯' || v === 'â—‹') return 6;
            if (['7', '8', '9', 'â–³'].includes(v)) return 3;
            const num = parseInt(v, 10);
            if (!isNaN(num)) {
                if (num >= 5 && num <= 6) return 2;
                if (num >= 3 && num <= 4) return 1;
                if (num >= 0 && num <= 2) return 0;
            }
            return 0;
        }

        function renderAll() {
            document.getElementById('match-count-display').textContent = matchCount;
            renderInputTable();
            renderRanking();
        }

        function renderInputTable() {
            const header = document.getElementById('table-header');
            const body = document.getElementById('table-body');
            
            // Header
            let headerHtml = `<th class="p-4 font-semibold text-slate-600 text-sm min-w-[150px]">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å</th>`;
            for (let i = 0; i < matchCount; i++) {
                headerHtml += `<th class="p-4 font-semibold text-slate-600 text-sm text-center">ç¬¬ ${i+1} è©¦åˆ</th>`;
            }
            headerHtml += `<th class="p-4 w-12"></th>`;
            header.innerHTML = headerHtml;

            // Body
            body.innerHTML = '';
            players.forEach((player, pIdx) => {
                const tr = document.createElement('tr');
                tr.className = 'border-b hover:bg-slate-50 transition-colors';
                
                let rowHtml = `
                    <td class="p-3">
                        <input type="text" value="${player.name}" oninput="updateName(${pIdx}, this.value)" 
                        class="w-full bg-transparent border-b border-transparent hover:border-slate-300 focus:border-indigo-500 focus:outline-none p-1 transition-colors font-medium">
                    </td>
                `;
                
                for (let mIdx = 0; mIdx < matchCount; mIdx++) {
                    const pt = calculatePoints(player.scores[mIdx]);
                    rowHtml += `
                        <td class="p-3 text-center">
                            <div class="flex flex-col items-center gap-1">
                                <input type="text" value="${player.scores[mIdx] || ''}" placeholder="0-10, â—¯, â–³"
                                oninput="updateScore(${pIdx}, ${mIdx}, this.value)"
                                class="w-16 h-10 text-center border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all shadow-sm">
                                <span class="text-[10px] text-slate-400 font-bold">${pt}pt</span>
                            </div>
                        </td>
                    `;
                }
                
                rowHtml += `
                    <td class="p-3 text-center">
                        <button onclick="removePlayer(${player.id})" class="text-slate-300 hover:text-red-500 p-2 transition-colors">ğŸ—‘ï¸</button>
                    </td>
                `;
                tr.innerHTML = rowHtml;
                body.appendChild(tr);
            });
        }

        function renderRanking() {
            const body = document.getElementById('ranking-body');
            
            const results = players.map(p => {
                const pts = p.scores.map(s => calculatePoints(s));
                const total = pts.reduce((a, b) => a + b, 0);
                return { ...p, matchPoints: pts, totalPoints: total };
            });

            // Sort
            results.sort((a, b) => b.totalPoints - a.totalPoints);

            body.innerHTML = '';
            results.forEach((p, idx) => {
                const rank = results.findIndex(item => item.totalPoints === p.totalPoints) + 1;
                const tr = document.createElement('tr');
                tr.className = 'border-b last:border-0';
                
                let rankClass = 'text-slate-500';
                if (rank === 1) rankClass = 'bg-yellow-100 text-yellow-700 ring-1 ring-yellow-400';
                else if (rank === 2) rankClass = 'bg-slate-100 text-slate-700 ring-1 ring-slate-400';
                else if (rank === 3) rankClass = 'bg-orange-100 text-orange-700 ring-1 ring-orange-400';

                tr.innerHTML = `
                    <td class="p-4 text-center">
                        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full font-bold text-sm ${rankClass}">${rank}</span>
                    </td>
                    <td class="p-4 font-bold text-slate-800">${p.name}</td>
                    <td class="p-4 text-center">
                        <div class="flex justify-center gap-1">
                            ${p.matchPoints.map(pt => `<div class="px-2 py-1 bg-slate-100 rounded text-[10px] text-slate-600 font-mono">${pt}</div>`).join('')}
                        </div>
                    </td>
                    <td class="p-4 text-center">
                        <span class="text-xl font-black text-indigo-700">${p.totalPoints}</span>
                        <span class="text-xs text-slate-400 ml-1">pt</span>
                    </td>
                `;
                body.appendChild(tr);
            });
        }

        function updateScore(pIdx, mIdx, val) {
            players[pIdx].scores[mIdx] = val;
            renderRanking();
            // å…¥åŠ›æ¬„ã®ä¸‹ã®ptè¡¨ç¤ºã ã‘æ›´æ–°ï¼ˆå…¨ä½“å†æç”»ã™ã‚‹ã¨ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒå¤–ã‚Œã‚‹ãŸã‚ï¼‰
            renderInputTableOnlyPoints();
        }

        function renderInputTableOnlyPoints() {
            const rows = document.getElementById('table-body').rows;
            players.forEach((p, pIdx) => {
                for(let mIdx = 0; mIdx < matchCount; mIdx++) {
                    const pt = calculatePoints(p.scores[mIdx]);
                    const span = rows[pIdx].cells[mIdx+1].querySelector('span');
                    if(span) span.textContent = pt + 'pt';
                }
            });
        }

        function updateName(pIdx, val) {
            players[pIdx].name = val;
            renderRanking();
        }

        function addPlayer() {
            players.push({ id: Date.now(), name: `Player ${players.length + 1}`, scores: Array(matchCount).fill('') });
            renderAll();
        }

        function removePlayer(id) {
            if (players.length <= 1) return;
            players = players.filter(p => p.id !== id);
            renderAll();
        }

        function changeMatchCount(delta) {
            const newCount = matchCount + delta;
            if (newCount < 1) return;
            
            if (delta > 0) {
                players.forEach(p => p.scores.push(''));
            } else {
                players.forEach(p => p.scores.pop());
            }
            matchCount = newCount;
            renderAll();
        }

        function exportCSV() {
            const results = players.map(p => {
                const total = p.scores.map(s => calculatePoints(s)).reduce((a, b) => a + b, 0);
                return { ...p, total };
            }).sort((a, b) => b.total - a.total);

            let csv = "é †ä½,ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å," + Array.from({length: matchCount}, (_, i) => `ç¬¬${i+1}è©¦åˆ`).join(",") + ",åˆè¨ˆ\n";
            results.forEach(p => {
                const rank = results.findIndex(item => item.total === p.total) + 1;
                csv += `${rank},${p.name},${p.scores.join(",")},${p.total}\n`;
            });

            const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
            const blob = new Blob([bom, csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'å¤§ä¼šçµæœ.csv';
            a.click();
        }

        // Initial Render
        renderAll();
    </script>
</body>
</html>